---
phase: 20-quick-wins-by-prody
plan: 05
type: execute
wave: 2
depends_on: []
files_modified:
  - packages/webapp/src/features/admin/components/MemberLeaderboard.tsx
  - packages/webapp/src/features/admin/components/RepDetailView.tsx
  - packages/webapp/src/pages/Dashboard.tsx
  - packages/webapp/src/features/dashboard/components/FirstTimeGuide.tsx
autonomous: true

must_haves:
  truths:
    - "Tapping a member in the admin leaderboard navigates to a rep detail view showing their stats"
    - "Rep detail view shows recent attempts, scores, lead count, and XP for the selected member"
    - "Brand new users (0 XP, 0 leads) see a guided onboarding card on the Dashboard"
    - "Guided tour card disappears once the user has XP > 0 or leads > 0"
  artifacts:
    - path: "packages/webapp/src/features/admin/components/RepDetailView.tsx"
      provides: "Admin rep detail view with user stats, recent attempts, lead count"
      contains: "RepDetailView"
    - path: "packages/webapp/src/features/admin/components/MemberLeaderboard.tsx"
      provides: "Tappable member rows with navigation to rep detail"
      contains: "onClick"
    - path: "packages/webapp/src/features/dashboard/components/FirstTimeGuide.tsx"
      provides: "Guided onboarding card for 0 XP + 0 leads users"
      contains: "FirstTimeGuide"
    - path: "packages/webapp/src/pages/Dashboard.tsx"
      provides: "FirstTimeGuide rendered conditionally for new users"
      contains: "FirstTimeGuide"
  key_links:
    - from: "packages/webapp/src/features/admin/components/MemberLeaderboard.tsx"
      to: "packages/webapp/src/features/admin/components/RepDetailView.tsx"
      via: "State toggle showing RepDetailView for selected member"
      pattern: "selectedMember|RepDetailView"
    - from: "packages/webapp/src/pages/Dashboard.tsx"
      to: "packages/webapp/src/features/dashboard/components/FirstTimeGuide.tsx"
      via: "Conditional render when user has 0 XP and 0 leads"
      pattern: "FirstTimeGuide"
---

<objective>
Implement admin rep detail view (QW #7) and first-time user guided tour (QW #9).

Purpose: Give admins coaching insight by allowing drill-down into individual rep performance, and ensure new user activation by showing a simple getting-started guide on the dashboard.

Output: New RepDetailView component, clickable MemberLeaderboard, new FirstTimeGuide component, Dashboard integration.
</objective>

<execution_context>
@/Users/dmytrolevin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dmytrolevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/webapp/src/features/admin/components/MemberLeaderboard.tsx
@packages/webapp/src/features/admin/hooks/useTeamLeaderboard.ts
@packages/webapp/src/pages/Dashboard.tsx
@packages/webapp/src/pages/Admin.tsx
@packages/webapp/src/features/dashboard/hooks/useUserProgress.ts
@packages/webapp/src/features/leads/hooks/useLeads.ts
@packages/webapp/src/lib/queries.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Admin rep detail view</name>
  <files>
    packages/webapp/src/features/admin/components/RepDetailView.tsx
    packages/webapp/src/features/admin/components/MemberLeaderboard.tsx
  </files>
  <action>
Create `RepDetailView.tsx`:
1. Define the component props:
   ```typescript
   interface RepDetailViewProps {
     user: {
       id: number;
       telegram_id: number;
       username: string | null;
       first_name: string | null;
       total_xp: number;
       current_level: number;
       current_streak: number;
     };
     avgScore: number;
     onBack: () => void;
   }
   ```
2. The component fetches additional data about this rep using existing InsForge queries:
   - Recent attempts: query `attempts` table for this `telegram_id`, select `scenario_id, score, difficulty, mode, created_at`, order by `created_at.desc`, limit 10.
   - Lead count: query `lead_registry` table, count rows where `telegram_id` matches.
   Use `useQuery` with keys like `['admin', 'repDetail', telegram_id, 'attempts']` and `['admin', 'repDetail', telegram_id, 'leadCount']`.
3. Render the detail view:
   - Back button (ArrowLeft icon + "Back to leaderboard" text) calling `onBack()`
   - Header card: Display name, XP, Level, Avg Score, Streak
   - Stats row: Total leads (from count query), Current level, Current streak
   - Recent attempts list: Up to 10 most recent, each showing scenario_id (truncated), score with color coding (green >=80, yellow >=50, red <50), difficulty badge, and relative date
4. Use existing UI components: `Card`, `Badge`, `Skeleton` for loading states.
5. Import `ArrowLeft`, `Trophy`, `Target`, `Flame` from lucide-react for icons.
6. Use `getInsforge()` for the data queries, following the same pattern as other admin hooks.

Modify `MemberLeaderboard.tsx`:
1. Import `{ useState }` from React and `RepDetailView`.
2. Add state: `const [selectedMember, setSelectedMember] = useState<{ user: ..., avgScore: number } | null>(null);`
3. When `selectedMember` is set, render `<RepDetailView user={selectedMember.user} avgScore={selectedMember.avgScore} onBack={() => setSelectedMember(null)} />` instead of the leaderboard list.
4. Make each member row clickable by wrapping the existing `<div>` in a `<button>` or adding `onClick={() => setSelectedMember(entry)}` and `cursor-pointer` class.
5. Add `ChevronRight` icon from lucide-react at the end of each row to indicate tappability.
  </action>
  <verify>
TypeScript compiles: `cd packages/webapp && npx tsc --noEmit`.
Grep confirms `RepDetailView` component in RepDetailView.tsx.
Grep confirms `onClick` or `setSelectedMember` in MemberLeaderboard.tsx.
  </verify>
  <done>
Admin can tap any leaderboard member to see their detail view with XP, level, streak, lead count, avg score, and 10 most recent attempts with scores. Back button returns to the leaderboard.
  </done>
</task>

<task type="auto">
  <name>Task 2: First-time user guided tour on Dashboard</name>
  <files>
    packages/webapp/src/features/dashboard/components/FirstTimeGuide.tsx
    packages/webapp/src/pages/Dashboard.tsx
  </files>
  <action>
Create `FirstTimeGuide.tsx`:
1. A simple guided onboarding card for brand-new users. No external dependencies needed.
2. Component definition:
   ```typescript
   export function FirstTimeGuide() {
     return (
       <Card className="border border-accent/20 bg-gradient-to-br from-accent/8 via-accent/4 to-transparent">
         <div className="space-y-4">
           <div>
             <p className="text-sm font-bold text-text">Welcome to Deal Quest!</p>
             <p className="mt-1 text-xs text-text-secondary">
               Get started in 3 simple steps:
             </p>
           </div>

           <div className="space-y-3">
             <div className="flex items-start gap-3">
               <span className="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-accent/15 text-xs font-bold text-accent">1</span>
               <div>
                 <p className="text-sm font-medium text-text">Send a prospect screenshot</p>
                 <p className="text-xs text-text-hint">Open the bot and send a LinkedIn profile, email, or business card photo</p>
               </div>
             </div>
             <div className="flex items-start gap-3">
               <span className="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-accent/15 text-xs font-bold text-accent">2</span>
               <div>
                 <p className="text-sm font-medium text-text">Get AI strategy</p>
                 <p className="text-xs text-text-hint">See analysis, engagement plan, and draft outreach</p>
               </div>
             </div>
             <div className="flex items-start gap-3">
               <span className="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-accent/15 text-xs font-bold text-accent">3</span>
               <div>
                 <p className="text-sm font-medium text-text">Follow the plan</p>
                 <p className="text-xs text-text-hint">Execute steps, track progress, close the deal</p>
               </div>
             </div>
           </div>

           <a
             href="https://t.me/DealQuestBot?start=support"
             target="_blank"
             rel="noopener noreferrer"
             className="block w-full rounded-xl bg-accent py-3 text-center text-sm font-semibold text-accent-text transition-all active:scale-[0.98]"
           >
             Open Bot & Try It
           </a>
         </div>
       </Card>
     );
   }
   ```
3. Import `Card` from `@/shared/ui`.

In `Dashboard.tsx`:
1. Import `FirstTimeGuide` from `@/features/dashboard/components/FirstTimeGuide`.
2. Import `useLeads` from `@/features/leads/hooks/useLeads`.
3. Add the leads query: `const { data: leads } = useLeads();`
4. Compute the first-time user condition:
   ```typescript
   const isFirstTimeUser = user && user.total_xp === 0 && (!leads || leads.length === 0);
   ```
5. Render `FirstTimeGuide` conditionally, placed right after the contextual alert banner and before the card layout:
   ```tsx
   {isFirstTimeUser && <FirstTimeGuide />}
   ```
6. The guide naturally disappears once the user gains XP (from training) or creates a lead (from the bot) since `useUserProgress` and `useLeads` will refetch and the condition becomes false.
  </action>
  <verify>
TypeScript compiles: `cd packages/webapp && npx tsc --noEmit`.
Grep confirms `FirstTimeGuide` in Dashboard.tsx.
Grep confirms `isFirstTimeUser` condition.
Grep confirms 3-step guide content in FirstTimeGuide.tsx.
  </verify>
  <done>
Brand new users (0 XP, 0 leads) see a guided onboarding card on the Dashboard with 3 numbered steps and an "Open Bot & Try It" CTA linking to the bot's support flow. Card disappears automatically once the user gains XP or creates their first lead.
  </done>
</task>

</tasks>

<verification>
1. RepDetailView.tsx exists with user stats, recent attempts, and lead count
2. MemberLeaderboard.tsx rows are tappable and toggle to show RepDetailView
3. FirstTimeGuide.tsx exists with 3-step getting-started guide
4. Dashboard.tsx renders FirstTimeGuide only when user.total_xp === 0 AND leads.length === 0
5. All files compile without TypeScript errors
</verification>

<success_criteria>
- Admin can tap any leaderboard member to drill into their stats
- Rep detail shows XP, level, streak, avg score, lead count, and recent attempts
- Back button returns to the leaderboard without page navigation
- First-time users see a clear 3-step guide with "Open Bot" CTA
- Guide auto-hides after user gains XP or creates a lead
- No new data sources -- all computed from existing tables/queries
</success_criteria>

<output>
After completion, create `.planning/phases/20-quick-wins-by-prody/20-05-SUMMARY.md`
</output>
