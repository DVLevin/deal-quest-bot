---
phase: 01-foundation-and-auth
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - deal-quest-bot/pnpm-workspace.yaml
  - deal-quest-bot/package.json
  - deal-quest-bot/packages/webapp/package.json
  - deal-quest-bot/packages/webapp/tsconfig.json
  - deal-quest-bot/packages/webapp/vite.config.ts
  - deal-quest-bot/packages/webapp/index.html
  - deal-quest-bot/packages/webapp/src/main.tsx
  - deal-quest-bot/packages/webapp/src/app/App.tsx
  - deal-quest-bot/packages/webapp/src/lib/telegram.ts
  - deal-quest-bot/packages/webapp/src/vite-env.d.ts
  - deal-quest-bot/packages/webapp/public/mockEnv.ts
  - deal-quest-bot/packages/shared/package.json
  - deal-quest-bot/packages/shared/tsconfig.json
  - deal-quest-bot/packages/shared/src/index.ts
  - deal-quest-bot/packages/shared/src/tables.ts
  - deal-quest-bot/packages/shared/src/enums.ts
  - deal-quest-bot/packages/shared/src/constants.ts
  - deal-quest-bot/.env.example
autonomous: true

must_haves:
  truths:
    - "pnpm dev starts Vite dev server with HTTPS on localhost and shows a React page"
    - "packages/shared types are importable from packages/webapp via @deal-quest/shared"
    - "Telegram SDK initializes without errors when loaded inside mockTelegramEnv"
    - "TypeScript interfaces in shared/tables.ts match the actual InsForge database schema columns"
  artifacts:
    - path: "deal-quest-bot/pnpm-workspace.yaml"
      provides: "Workspace configuration for packages/*"
      contains: "packages"
    - path: "deal-quest-bot/packages/webapp/vite.config.ts"
      provides: "Vite 7 config with React SWC, Tailwind v4, mkcert, tsconfig paths"
      contains: "tailwindcss"
    - path: "deal-quest-bot/packages/webapp/src/main.tsx"
      provides: "App entry point"
      contains: "createRoot"
    - path: "deal-quest-bot/packages/webapp/src/lib/telegram.ts"
      provides: "Telegram SDK initialization function"
      contains: "init"
    - path: "deal-quest-bot/packages/shared/src/tables.ts"
      provides: "TypeScript interfaces for all InsForge tables"
      contains: "telegram_id"
  key_links:
    - from: "packages/webapp/package.json"
      to: "packages/shared"
      via: "workspace:* dependency"
      pattern: "@deal-quest/shared.*workspace"
    - from: "packages/webapp/src/lib/telegram.ts"
      to: "@telegram-apps/sdk-react"
      via: "SDK init + component mounting"
      pattern: "import.*@telegram-apps/sdk-react"
---

<objective>
Scaffold the monorepo with pnpm workspaces, set up the React 18 + Vite 7 + TypeScript webapp package, create the shared types package mirroring InsForge table schemas, and initialize the Telegram SDK with a mock environment for browser development.

Purpose: Establish the foundational project structure that all subsequent Phase 1 plans depend on. Without this scaffold, no auth, routing, or design system work can begin.
Output: A working monorepo where `pnpm dev` starts Vite, React renders, Telegram SDK initializes, and shared types compile.
</objective>

<execution_context>
@/Users/dmytrolevin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dmytrolevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-auth/01-RESEARCH.md
@deal-quest-bot/bot/storage/models.py
@deal-quest-bot/bot/config.py
@deal-quest-bot/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create monorepo scaffold with pnpm workspaces and Vite 7 webapp</name>
  <files>
    deal-quest-bot/pnpm-workspace.yaml
    deal-quest-bot/package.json
    deal-quest-bot/packages/webapp/package.json
    deal-quest-bot/packages/webapp/tsconfig.json
    deal-quest-bot/packages/webapp/vite.config.ts
    deal-quest-bot/packages/webapp/index.html
    deal-quest-bot/packages/webapp/src/main.tsx
    deal-quest-bot/packages/webapp/src/app/App.tsx
    deal-quest-bot/packages/webapp/src/vite-env.d.ts
    deal-quest-bot/packages/webapp/public/mockEnv.ts
    deal-quest-bot/.env.example
  </files>
  <action>
    Create the pnpm workspace structure inside deal-quest-bot/:

    1. **pnpm-workspace.yaml**: Define `packages: ["packages/*"]`

    2. **Root package.json**:
       ```json
       {
         "private": true,
         "scripts": {
           "dev": "pnpm --filter @deal-quest/webapp dev",
           "build": "pnpm --filter @deal-quest/webapp build",
           "typecheck": "pnpm -r typecheck"
         }
       }
       ```

    3. **packages/webapp/package.json**: Name `@deal-quest/webapp`, private. Dependencies:
       - react ^18.3.1, react-dom ^18.3.1
       - @telegram-apps/sdk-react ^3.3.9
       - react-router ^7.12.0
       - @insforge/sdk (latest)
       - @tanstack/react-query ^5.90.0
       - zustand ^5.0.10
       - tailwindcss ^4.1.0, @tailwindcss/vite (latest)
       - clsx ^2.0.0, tailwind-merge ^3.0.0, class-variance-authority ^0.7.0
       - lucide-react ^0.562.0
       - eruda ^3.4.3
       - Workspace dep: `"@deal-quest/shared": "workspace:*"`
       DevDependencies:
       - typescript ^5.9.0, @types/react ^18.3.0, @types/react-dom ^18.3.0
       - vite ^7.3.0, @vitejs/plugin-react-swc (latest)
       - vite-plugin-mkcert ^1.17.8, vite-tsconfig-paths (latest)
       Scripts: `"dev": "vite"`, `"build": "vite build"`, `"typecheck": "tsc --noEmit"`

    4. **packages/webapp/tsconfig.json**: Target ES2020, module ESNext, moduleResolution bundler, jsx react-jsx, strict true. Path alias: `"@/*": ["./src/*"]`. Include `src`.

    5. **packages/webapp/vite.config.ts**:
       ```typescript
       import { defineConfig } from 'vite';
       import react from '@vitejs/plugin-react-swc';
       import tailwindcss from '@tailwindcss/vite';
       import mkcert from 'vite-plugin-mkcert';
       import tsconfigPaths from 'vite-tsconfig-paths';

       export default defineConfig({
         plugins: [react(), tailwindcss(), mkcert(), tsconfigPaths()],
         base: '/',
         build: { outDir: 'dist', target: 'es2020' },
         server: { host: true },
       });
       ```

    6. **packages/webapp/index.html**: Standard HTML5 with `<div id="root">`, script tag pointing to `/src/main.tsx`. Include `<script src="/mockEnv.ts">` guarded by a comment that it's for dev only. Add `<meta name="color-scheme" content="light dark">` to prevent FOUC.

    7. **packages/webapp/src/main.tsx**: Import and call `initTelegramSDK()` from `@/lib/telegram`. Then render `<App />` into root div using `createRoot`. Initialize eruda in dev mode: `if (import.meta.env.DEV) { import('eruda').then(m => m.default.init()); }`

    8. **packages/webapp/src/app/App.tsx**: Minimal component rendering `<div>Deal Quest TMA</div>` as a placeholder. This will be expanded in later plans.

    9. **packages/webapp/src/lib/telegram.ts**: Implement `initTelegramSDK()` function following the exact pattern from research:
       - Call `init()` from SDK
       - Mount: `backButton.mount()`, `mainButton.mount()`, `themeParams.mount()`, `miniApp.mount()`
       - Async mount viewport: `viewport.mount().then(() => viewport.bindCssVars())`
       - Bind theme CSS vars: `themeParams.bindCssVars()`
       - Disable vertical swipe if available: `if (swipeBehavior.mount.isAvailable()) { swipeBehavior.mount(); swipeBehavior.disableVertical(); }`
       - Call `miniApp.ready()`
       - Export `getLaunchParams()` wrapping `retrieveLaunchParams()`

    10. **packages/webapp/src/vite-env.d.ts**: Standard Vite client types reference.

    11. **packages/webapp/public/mockEnv.ts**: Copy the mock environment pattern from the official TMA React template. This provides a mock `window.Telegram.WebApp` object for browser development outside Telegram. Guard with `if (!(window as any).Telegram)`.

    12. **deal-quest-bot/.env.example**: Add TMA-related env vars:
        ```
        # Existing bot vars (keep as-is)
        TELEGRAM_BOT_TOKEN=
        ENCRYPTION_KEY=
        INSFORGE_BASE_URL=https://wz7ymxxu.eu-central.insforge.app
        INSFORGE_ANON_KEY=

        # TMA vars (prefixed VITE_ for client-side access)
        VITE_INSFORGE_URL=https://wz7ymxxu.eu-central.insforge.app
        VITE_INSFORGE_ANON_KEY=
        ```

    **Critical:** Do NOT install `@telegram-apps/sdk` separately -- it is bundled with `@telegram-apps/sdk-react`. Do NOT install `react-router-dom` -- use `react-router` (unified v7 package). Do NOT create `tailwind.config.js` -- Tailwind v4 uses CSS-first config via `@theme` directive.

    After creating all files, run `cd deal-quest-bot && pnpm install` to install all dependencies and link workspaces.
  </action>
  <verify>
    1. `cd deal-quest-bot && pnpm install` completes without errors
    2. `cd deal-quest-bot && pnpm typecheck` passes (TypeScript compilation clean)
    3. `cd deal-quest-bot && pnpm build` produces dist/ output without errors
    4. Verify packages/webapp/node_modules/@deal-quest/shared is symlinked to packages/shared
  </verify>
  <done>
    pnpm workspace resolves, TypeScript compiles cleanly, Vite builds successfully, and the @deal-quest/shared workspace dependency is linked.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared types package mirroring InsForge table schemas</name>
  <files>
    deal-quest-bot/packages/shared/package.json
    deal-quest-bot/packages/shared/tsconfig.json
    deal-quest-bot/packages/shared/src/index.ts
    deal-quest-bot/packages/shared/src/tables.ts
    deal-quest-bot/packages/shared/src/enums.ts
    deal-quest-bot/packages/shared/src/constants.ts
  </files>
  <action>
    Create the shared types package that mirrors the ACTUAL InsForge database schema (not the Python models -- research confirmed discrepancies).

    1. **packages/shared/package.json**:
       ```json
       {
         "name": "@deal-quest/shared",
         "version": "0.0.1",
         "private": true,
         "main": "src/index.ts",
         "types": "src/index.ts"
       }
       ```

    2. **packages/shared/tsconfig.json**: Target ES2020, module ESNext, moduleResolution bundler, strict true. Include `src`.

    3. **packages/shared/src/tables.ts**: Create TypeScript interfaces for ALL 10 InsForge tables based on the ACTUAL schema (from research, not Python models). Key differences from Python models:
       - `attempts` table does NOT have `username` or `user_response` columns (Python model has them as transient fields)
       - `generated_scenarios` may not exist yet -- include the type but mark with a comment noting it needs creation
       - All `id` fields are `number` (auto-increment integers)
       - All `telegram_id` fields are `number` (BIGINT maps to number in TS)
       - JSONB fields map to appropriate TS types (Record<string, unknown> or specific interfaces)
       - Date fields are `string` (ISO 8601 format from PostgREST)

       Interfaces to create (use `Row` suffix pattern for DB rows):
       - `UserRow`: id, telegram_id, username, first_name, provider, encrypted_api_key, openrouter_model, total_xp, current_level, streak_days, last_active_at, created_at, updated_at
       - `AttemptRow`: id, user_id, telegram_id, scenario_id, mode, score, feedback_json, xp_earned, created_at (NO username, NO user_response)
       - `TrackProgressRow`: id, user_id, telegram_id, track_id, level_id, status, best_score, attempts_count, completed_at, created_at, updated_at
       - `SupportSessionRow`: id, user_id, telegram_id, input_text, output_json, provider_used, created_at
       - `ScenarioSeenRow`: id, user_id, telegram_id, scenario_id, seen_at
       - `LeadRegistryRow`: id, user_id, telegram_id, prospect_name, prospect_title, prospect_company, photo_url, photo_key, prospect_analysis, closing_strategy, engagement_tactics, draft_response, status, notes, input_type, original_context, web_research, engagement_plan (JSONB), last_contacted, next_followup, followup_count, created_at, updated_at
       - `LeadActivityRow`: id, lead_id, telegram_id, activity_type, content, ai_response, created_at
       - `CasebookRow`: id, persona_type, scenario_type, industry, seniority, prospect_analysis, closing_strategy, engagement_tactics, draft_response, playbook_references, quality_score, user_accepted_first_draft, user_feedback, created_from_user, created_at
       - `UserMemoryRow`: id, user_id, telegram_id, memory_data (JSONB), created_at, updated_at
       - `GeneratedScenarioRow`: id, scenario_id, category, difficulty, persona (JSONB), situation, scoring_focus (JSONB array), ideal_response, scoring_rubric (JSONB), source_type, source_casebook_ids (JSONB array), times_used, avg_score, created_at -- mark with `// NOTE: Table may not exist yet in InsForge`

    4. **packages/shared/src/enums.ts**: Create string literal union types for:
       - `TrackStatus = 'locked' | 'unlocked' | 'completed'`
       - `AttemptMode = 'learn' | 'train'`
       - `LeadStatus = 'analyzed' | 'reached_out' | 'meeting' | 'in_progress' | 'closed'`
       - `LeadActivityType = 'context_update' | 'screenshot_comment' | 'ai_advice' | 'followup_sent'`
       - `LLMProvider = 'openrouter' | 'anthropic'`
       - `InputType = 'text' | 'photo' | 'screenshot'`
       - `ScenarioSourceType = 'hybrid' | 'casebook' | 'generated'`
       - `Difficulty = 1 | 2 | 3` (Easy/Medium/Hard)

    5. **packages/shared/src/constants.ts**: Export game constants:
       - `XP_PER_LEVEL` array or function mapping level to XP threshold
       - `RANK_TITLES` array: ['Rookie', 'Apprentice', 'Associate', 'Specialist', 'Expert', 'Master', 'Champion', 'Legend'] (8 ranks matching current_level 1-8+)
       - `PASSING_SCORE = 60` (score >= 60% unlocks next level)
       - `MAX_STREAK_BONUS_XP = 50`
       - `LEAD_STATUSES` ordered array for pipeline display

    6. **packages/shared/src/index.ts**: Re-export everything from tables.ts, enums.ts, constants.ts.

    **Critical:** Use the ACTUAL InsForge schema columns from the research doc table, NOT the Python Pydantic models. The Python models include transient fields (like `AttemptModel.username`) that don't exist in the database.
  </action>
  <verify>
    1. `cd deal-quest-bot && pnpm typecheck` passes
    2. In packages/webapp/src/app/App.tsx, add a temporary import: `import type { UserRow } from '@deal-quest/shared'` -- verify it resolves
    3. Verify tables.ts contains interfaces for all 10 tables
    4. Verify AttemptRow does NOT have username or user_response fields
  </verify>
  <done>
    All 10 InsForge table interfaces exist in tables.ts, enums cover all status/mode types, constants define game progression values, and the shared package is importable from webapp.
  </done>
</task>

</tasks>

<verification>
1. `cd deal-quest-bot && pnpm install && pnpm typecheck && pnpm build` -- all three pass
2. `ls deal-quest-bot/packages/webapp/dist/` -- build output exists
3. `ls deal-quest-bot/packages/shared/src/tables.ts` -- shared types exist
4. Verify no `@telegram-apps/sdk` in package.json (only sdk-react)
5. Verify no `react-router-dom` in package.json (only react-router)
6. Verify no `tailwind.config.js` or `tailwind.config.ts` exists
</verification>

<success_criteria>
- Monorepo structure works: pnpm install links workspaces, build succeeds
- Shared types are importable from webapp package
- Vite dev server can start (HTTPS via mkcert)
- TypeScript compiles with zero errors
- All 10 InsForge table interfaces defined in shared package
- Telegram SDK initialization function exists and is called at app startup
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-auth/01-01-SUMMARY.md`
</output>
