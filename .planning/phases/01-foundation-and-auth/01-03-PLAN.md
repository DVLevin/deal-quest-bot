---
phase: 01-foundation-and-auth
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - deal-quest-bot/packages/webapp/src/app/globals.css
  - deal-quest-bot/packages/webapp/src/shared/ui/Button.tsx
  - deal-quest-bot/packages/webapp/src/shared/ui/Card.tsx
  - deal-quest-bot/packages/webapp/src/shared/ui/Badge.tsx
  - deal-quest-bot/packages/webapp/src/shared/ui/Skeleton.tsx
  - deal-quest-bot/packages/webapp/src/shared/ui/index.ts
  - deal-quest-bot/packages/webapp/src/shared/layouts/AppLayout.tsx
  - deal-quest-bot/packages/webapp/src/shared/ui/NavBar.tsx
  - deal-quest-bot/packages/webapp/src/shared/lib/cn.ts
autonomous: true

must_haves:
  truths:
    - "Design tokens defined in CSS with @theme directive match Deal Quest brand and adapt to Telegram dark/light theme"
    - "Base UI components (Button, Card, Badge, Skeleton) render with correct styling and accept variant props"
    - "AppLayout provides safe-area-aware page shell with NavBar at the bottom"
    - "NavBar shows navigation items for all main pages with active state highlighting"
  artifacts:
    - path: "deal-quest-bot/packages/webapp/src/app/globals.css"
      provides: "Tailwind v4 import + @theme design tokens with Telegram theme var fallbacks"
      contains: "@theme"
    - path: "deal-quest-bot/packages/webapp/src/shared/ui/Button.tsx"
      provides: "Button component with variant/size props via CVA"
      contains: "cva"
    - path: "deal-quest-bot/packages/webapp/src/shared/ui/Card.tsx"
      provides: "Card container component with optional padding/elevation variants"
      contains: "Card"
    - path: "deal-quest-bot/packages/webapp/src/shared/layouts/AppLayout.tsx"
      provides: "Page shell with safe area padding and bottom NavBar"
      contains: "safe"
    - path: "deal-quest-bot/packages/webapp/src/shared/ui/NavBar.tsx"
      provides: "Bottom navigation bar with icons for all main pages"
      contains: "NavLink"
  key_links:
    - from: "packages/webapp/src/app/globals.css"
      to: "Telegram SDK CSS vars"
      via: "@theme directive mapping --tg-theme-* to semantic colors"
      pattern: "--tg-theme"
    - from: "packages/webapp/src/shared/layouts/AppLayout.tsx"
      to: "Telegram SDK viewport vars"
      via: "Safe area padding from --tg-viewport-* CSS variables"
      pattern: "--tg-viewport|safe-area"
    - from: "packages/webapp/src/shared/ui/Button.tsx"
      to: "packages/webapp/src/shared/lib/cn.ts"
      via: "cn() utility for merging Tailwind classes"
      pattern: "cn\\("
---

<objective>
Build the custom branded design system with Tailwind CSS v4 design tokens, base UI components (Button, Card, Badge, Skeleton), the AppLayout shell with safe-area handling, and the bottom NavBar for page navigation.

Purpose: The design system and layout shell are the visual foundation. Every page in the TMA will use these components and sit inside this layout. Building them in parallel with auth (Plan 02) maximizes development speed.
Output: A working design system with Deal Quest branding, Telegram theme adaptation, safe-area-aware layout, and bottom navigation.
</objective>

<execution_context>
@/Users/dmytrolevin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dmytrolevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-auth/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tailwind v4 design tokens and cn() utility</name>
  <files>
    deal-quest-bot/packages/webapp/src/app/globals.css
    deal-quest-bot/packages/webapp/src/shared/lib/cn.ts
  </files>
  <action>
    1. **globals.css**: Create the Tailwind v4 CSS-first configuration with Deal Quest brand tokens and Telegram theme integration. Follow the exact pattern from the research doc:

       ```css
       @import "tailwindcss";

       @theme {
         /* Brand colors - Deal Quest identity */
         --color-brand-50: oklch(0.97 0.01 250);
         --color-brand-100: oklch(0.93 0.03 250);
         --color-brand-200: oklch(0.88 0.06 250);
         --color-brand-300: oklch(0.80 0.09 250);
         --color-brand-400: oklch(0.72 0.12 250);
         --color-brand-500: oklch(0.65 0.15 250);
         --color-brand-600: oklch(0.55 0.18 250);
         --color-brand-700: oklch(0.45 0.18 250);
         --color-brand-800: oklch(0.35 0.15 250);
         --color-brand-900: oklch(0.25 0.10 250);

         /* Semantic colors mapped from Telegram theme vars */
         --color-surface: var(--tg-theme-bg-color, #ffffff);
         --color-surface-secondary: var(--tg-theme-secondary-bg-color, #f0f0f0);
         --color-text-primary: var(--tg-theme-text-color, #000000);
         --color-text-secondary: var(--tg-theme-subtitle-text-color, #666666);
         --color-text-hint: var(--tg-theme-hint-color, #999999);
         --color-accent: var(--tg-theme-button-color, var(--color-brand-500));
         --color-accent-text: var(--tg-theme-button-text-color, #ffffff);
         --color-link: var(--tg-theme-link-color, var(--color-brand-600));
         --color-destructive: var(--tg-theme-destructive-text-color, #ff3b30);
         --color-header-bg: var(--tg-theme-header-bg-color, var(--color-brand-700));

         /* Status colors */
         --color-success: oklch(0.72 0.19 150);
         --color-warning: oklch(0.80 0.18 85);
         --color-error: oklch(0.65 0.22 25);
         --color-info: oklch(0.70 0.15 250);

         /* Rarity tier colors (for badges) */
         --color-rarity-common: oklch(0.70 0.05 250);
         --color-rarity-rare: oklch(0.65 0.20 260);
         --color-rarity-epic: oklch(0.55 0.25 300);
         --color-rarity-legendary: oklch(0.70 0.22 65);

         /* Safe area spacing from Telegram SDK viewport.bindCssVars() */
         --spacing-safe-top: var(--tg-viewport-safe-area-inset-top, 0px);
         --spacing-safe-bottom: var(--tg-viewport-safe-area-inset-bottom, 0px);
         --spacing-content-top: var(--tg-viewport-content-safe-area-inset-top, 0px);
         --spacing-content-bottom: var(--tg-viewport-content-safe-area-inset-bottom, 0px);

         /* Typography */
         --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;

         /* Border radius tokens */
         --radius-card: 12px;
         --radius-button: 10px;
         --radius-badge: 8px;
         --radius-full: 9999px;

         /* Shadows */
         --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
         --shadow-card-hover: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
       }

       /* Base styles */
       html, body, #root {
         height: 100%;
         margin: 0;
         padding: 0;
         background-color: var(--color-surface);
         color: var(--color-text-primary);
         font-family: var(--font-sans);
         -webkit-font-smoothing: antialiased;
         -moz-osx-font-smoothing: grayscale;
         overflow-x: hidden;
       }

       /* Prevent pull-to-refresh in WebView */
       body {
         overscroll-behavior-y: contain;
       }
       ```

    2. **shared/lib/cn.ts**: Create the `cn()` utility combining clsx and tailwind-merge:
       ```typescript
       import { clsx, type ClassValue } from 'clsx';
       import { twMerge } from 'tailwind-merge';

       export function cn(...inputs: ClassValue[]) {
         return twMerge(clsx(inputs));
       }
       ```

    3. **Update main.tsx** to import globals.css: Add `import '@/app/globals.css';` at the top of main.tsx (before App import).

    **CRITICAL**: Do NOT use `env(safe-area-inset-*)` CSS -- it silently fails in Telegram WebView on iOS (GitHub Issue #1377). Use the `--tg-viewport-*` vars from the SDK's `viewport.bindCssVars()` call instead.

    **CRITICAL**: Do NOT create a `tailwind.config.js` or `tailwind.config.ts` file. Tailwind v4 uses CSS-first config via `@theme` in globals.css. The `@tailwindcss/vite` plugin handles everything.
  </action>
  <verify>
    1. `pnpm build` succeeds (Tailwind processes the @theme directive)
    2. globals.css contains `@import "tailwindcss"` and `@theme` block
    3. No `tailwind.config.js` or `tailwind.config.ts` exists in the project
    4. No `env(safe-area-inset-*)` in any CSS file
    5. cn.ts exports the cn function
  </verify>
  <done>
    Design tokens defined via @theme with Deal Quest brand colors, Telegram theme variable fallbacks, safe area spacing from SDK, and cn() utility for class merging.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build base UI components (Button, Card, Badge, Skeleton) and NavBar</name>
  <files>
    deal-quest-bot/packages/webapp/src/shared/ui/Button.tsx
    deal-quest-bot/packages/webapp/src/shared/ui/Card.tsx
    deal-quest-bot/packages/webapp/src/shared/ui/Badge.tsx
    deal-quest-bot/packages/webapp/src/shared/ui/Skeleton.tsx
    deal-quest-bot/packages/webapp/src/shared/ui/NavBar.tsx
    deal-quest-bot/packages/webapp/src/shared/ui/index.ts
    deal-quest-bot/packages/webapp/src/shared/layouts/AppLayout.tsx
  </files>
  <action>
    Create the foundational UI components using CVA for variants, cn() for class merging, and Tailwind v4 utility classes referencing the design tokens.

    1. **Button.tsx**: Create with CVA variants:
       - Variants: `variant` (primary, secondary, ghost, destructive), `size` (sm, md, lg)
       - Primary uses `bg-accent text-accent-text`
       - Secondary uses `bg-surface-secondary text-text-primary`
       - Ghost uses transparent background
       - All sizes have minimum 44px touch target (mobile accessibility)
       - Props: extends `ButtonHTMLAttributes<HTMLButtonElement>`, adds `variant`, `size`, `isLoading`
       - Loading state shows a spinner and disables the button
       - Use `rounded-button` for border radius

    2. **Card.tsx**: Container component:
       - Props: `children`, `className`, `padding` ('none' | 'sm' | 'md' | 'lg'), `as` (element tag, default 'div')
       - Default: `bg-surface rounded-card shadow-card`
       - Padding variants: none=0, sm=p-3, md=p-4, lg=p-6
       - Accept className for overrides via cn()

    3. **Badge.tsx**: Small status/label component:
       - Variants: `variant` (default, success, warning, error, info, brand), `size` (sm, md)
       - Uses design token colors for each variant
       - `rounded-badge` border radius
       - Props: extends `HTMLAttributes<HTMLSpanElement>`, adds `variant`, `size`

    4. **Skeleton.tsx**: Loading placeholder:
       - Animated shimmer effect using Tailwind's `animate-pulse`
       - Props: `className`, `width`, `height` (optional, for fixed dimensions)
       - Renders as a `div` with `bg-surface-secondary rounded-card`
       - `SkeletonText` sub-component for text placeholders (different height)

    5. **NavBar.tsx**: Bottom navigation bar:
       - Fixed to bottom with safe-area padding: `pb-[var(--spacing-safe-bottom)]`
       - Background: `bg-surface` with top border
       - 5 nav items: Dashboard, Learn, Train, Support, Leads (main user-facing pages)
       - Each item: icon (lucide-react) + label text
       - Active state: `text-accent`, inactive: `text-text-hint`
       - Use `NavLink` from react-router for active state detection (import from 'react-router')
       - Icons: `LayoutDashboard` (Dashboard), `BookOpen` (Learn), `Swords` (Train), `Handshake` (Support), `Users` (Leads)
       - Touch target: full width of each tab area, min 44px height
       - The NavBar does NOT show Profile, Casebook, or Admin -- these are accessed via Dashboard quick actions or specific routes

    6. **AppLayout.tsx**: Page shell component:
       - Takes `children` prop
       - Wraps content in a container with safe area padding:
         - Top: `pt-[var(--spacing-content-top)]` (content safe area)
         - Bottom: enough padding to clear the NavBar height + safe area
       - Renders NavBar at the bottom
       - Scrollable content area between header and NavBar
       - Full height layout: `flex flex-col h-full`

    7. **index.ts**: Re-export all UI components:
       ```typescript
       export { Button } from './Button';
       export { Card } from './Card';
       export { Badge } from './Badge';
       export { Skeleton, SkeletonText } from './Skeleton';
       export { NavBar } from './NavBar';
       ```

    **Design principles:**
    - Mobile-first: 360px minimum width assumed
    - 44px minimum touch targets on all interactive elements
    - Semantic color usage: always use design token colors (text-primary, surface, accent) not raw Tailwind colors
    - All components accept className prop for overrides
  </action>
  <verify>
    1. `pnpm typecheck` passes
    2. `pnpm build` succeeds
    3. All UI components export correctly from shared/ui/index.ts
    4. Button has variant and size props via CVA
    5. NavBar uses NavLink from react-router for active detection
    6. AppLayout uses --tg-viewport-* safe area vars, NOT env(safe-area-inset-*)
    7. All interactive elements have min 44px touch targets
  </verify>
  <done>
    5 base UI components (Button, Card, Badge, Skeleton, NavBar) and AppLayout shell are built with Deal Quest branding, Telegram theme adaptation, safe-area handling, and mobile-first touch targets.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck && pnpm build` -- both pass
2. Design tokens in globals.css use Telegram theme CSS vars with fallbacks
3. No `env(safe-area-inset-*)` anywhere in the codebase
4. All components use cn() for class merging
5. NavBar has 5 items with lucide-react icons
6. AppLayout wraps content with safe area padding
</verification>

<success_criteria>
- Tailwind v4 @theme directive works with Vite build
- Design tokens map Telegram theme vars to semantic colors with fallbacks
- All 5 UI components render and accept variant props
- AppLayout provides safe-area-aware page shell
- NavBar shows bottom navigation with active state highlighting
- Mobile-first: 360px min width, 44px touch targets
- No hardcoded colors -- all referencing design tokens
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-auth/01-03-SUMMARY.md`
</output>
