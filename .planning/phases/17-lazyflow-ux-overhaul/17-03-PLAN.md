---
phase: 17-lazyflow-ux-overhaul
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/webapp/src/features/leads/components/LeadStatusSelector.tsx
  - packages/webapp/src/features/leads/components/LeadNotes.tsx
  - packages/webapp/src/features/leads/types.ts
autonomous: true

must_haves:
  truths:
    - "LeadStatusSelector highlights the suggested next status with a visual accent ring"
    - "Lead notes textarea shows context-aware placeholder based on current lead status"
    - "Suggested next status is never forced -- user can tap any status as before"
    - "Status suggestion follows pipeline progression order"
  artifacts:
    - path: "packages/webapp/src/features/leads/components/LeadStatusSelector.tsx"
      provides: "Status selector with suggested next-status visual highlight"
      contains: "suggestedNext"
    - path: "packages/webapp/src/features/leads/components/LeadNotes.tsx"
      provides: "Notes form with context-aware placeholder"
      contains: "getNotePlaceholder"
    - path: "packages/webapp/src/features/leads/types.ts"
      provides: "suggestNextStatus utility and note placeholder mapping"
      exports: ["suggestNextStatus", "getNotePlaceholder"]
  key_links:
    - from: "packages/webapp/src/features/leads/components/LeadStatusSelector.tsx"
      to: "suggestNextStatus"
      via: "import and conditional styling"
      pattern: "suggestNextStatus"
    - from: "packages/webapp/src/features/leads/components/LeadNotes.tsx"
      to: "getNotePlaceholder"
      via: "placeholder prop"
      pattern: "getNotePlaceholder"
---

<objective>
Add smart defaults to lead management: suggest the next pipeline status with a visual cue and show context-aware placeholder text in notes.

Purpose: Success Criterion 4 -- "Every TMA form and input uses smart defaults" -- empty fields and generic placeholders are replaced with intelligent suggestions based on the lead's current state.

Output: Updated LeadStatusSelector with suggestion highlight, updated LeadNotes with smart placeholders, utility functions in types.ts.
</objective>

<execution_context>
@/Users/dmytrolevin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dmytrolevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/webapp/src/features/leads/components/LeadStatusSelector.tsx
@packages/webapp/src/features/leads/components/LeadNotes.tsx
@packages/webapp/src/features/leads/components/LeadDetail.tsx
@packages/webapp/src/features/leads/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add suggestNextStatus and getNotePlaceholder utilities</name>
  <files>
    packages/webapp/src/features/leads/types.ts
  </files>
  <action>
    Add two utility functions at the end of `types.ts` (after existing exports):

    1. **suggestNextStatus function:**
       ```typescript
       /**
        * Suggest the next logical pipeline status based on current status.
        * Returns null if at the end of the pipeline or status is unknown.
        */
       export function suggestNextStatus(currentStatus: string): string | null {
         const STATUS_ORDER = ['analyzed', 'reached_out', 'meeting_booked', 'in_progress', 'closed_won'];
         const idx = STATUS_ORDER.indexOf(currentStatus);
         if (idx >= 0 && idx < STATUS_ORDER.length - 1) {
           return STATUS_ORDER[idx + 1];
         }
         return null;
       }
       ```
       - NOTE: Use the actual status values from the codebase. Check `LEAD_STATUS_CONFIG` in types.ts to confirm the status keys. Adjust the array to match the real keys used in the pipeline order.

    2. **getNotePlaceholder function:**
       ```typescript
       /**
        * Return a context-aware placeholder for the notes textarea based on lead status.
        * Helps users know what kind of note is most useful at each stage.
        */
       export function getNotePlaceholder(status: string): string {
         const PLACEHOLDERS: Record<string, string> = {
           analyzed: 'What do you know about this prospect? Any mutual connections?',
           reached_out: 'How did the outreach go? Did they respond?',
           meeting_booked: 'What topics should you cover? Any prep notes?',
           in_progress: 'How is the deal progressing? Any blockers?',
           closed_won: 'What worked? Any lessons for future deals?',
           closed_lost: 'Why did it fall through? What would you do differently?',
         };
         return PLACEHOLDERS[status] ?? 'Add context, reminders, or follow-up notes...';
       }
       ```
       - Again, match the real status keys from `LEAD_STATUS_CONFIG`.

    Read types.ts first to confirm the exact status keys used in `LEAD_STATUS_CONFIG`, then adapt the arrays/maps accordingly.
  </action>
  <verify>
    Run `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx tsc --noEmit` -- no type errors.
  </verify>
  <done>
    `suggestNextStatus` and `getNotePlaceholder` exported from types.ts with correct status keys matching LEAD_STATUS_CONFIG.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire smart defaults into LeadStatusSelector and LeadNotes</name>
  <files>
    packages/webapp/src/features/leads/components/LeadStatusSelector.tsx
    packages/webapp/src/features/leads/components/LeadNotes.tsx
  </files>
  <action>
    **Update LeadStatusSelector.tsx:**

    1. Import `suggestNextStatus` from `../types`.
    2. Compute the suggested status inside the component: `const suggestedNext = suggestNextStatus(currentStatus);`
    3. In the button rendering, add a visual cue for the suggested next status. Update the className logic:
       - Add a new condition: when `status === suggestedNext && !isActive`:
         - Apply a ring/border accent: `ring-2 ring-accent/40 bg-accent/10 text-accent`
         - This is a subtle visual hint, NOT a forced selection.
       - Updated className logic:
         ```tsx
         className={cn(
           'min-h-[44px] shrink-0 rounded-full px-4 text-xs font-medium transition-all',
           isActive
             ? 'bg-accent text-white shadow-sm'
             : status === suggestedNext
               ? 'ring-2 ring-accent/40 bg-accent/10 text-accent active:bg-accent/20'
               : 'bg-surface-secondary text-text-secondary active:bg-surface-secondary/70',
           isUpdating && 'opacity-50',
         )}
         ```
    4. Optionally, add a small "Suggested" label below or inside the suggested button. A simpler approach: just the visual ring is enough to draw attention without adding text clutter.

    **Update LeadNotes.tsx:**

    1. Add a `status` prop to the component interface:
       ```typescript
       interface LeadNotesProps {
         leadId: number;
         currentNote: string | null;
         status?: string;
       }
       ```
    2. Import `getNotePlaceholder` from `../types`.
    3. Replace the hardcoded placeholder string in the textarea:
       ```tsx
       placeholder={getNotePlaceholder(status ?? '')}
       ```
    4. This is backward-compatible: if `status` is not provided, `getNotePlaceholder('')` returns the default placeholder.

    **Update LeadDetail.tsx (caller):**
    The LeadNotes component is rendered in LeadDetail.tsx. Find where `<LeadNotes leadId={...} currentNote={...} />` is rendered and add the `status` prop:
    ```tsx
    <LeadNotes leadId={lead.id} currentNote={lead.notes} status={lead.status} />
    ```
    Read LeadDetail.tsx to find the exact usage and add the prop.

    IMPORTANT: The suggested status highlight must NOT disable any button or prevent any status selection. It is purely visual guidance.
    IMPORTANT: Do NOT change the LeadStatusSelector interface -- `currentStatus` comes from the parent, no new required props.
  </action>
  <verify>
    Run `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx tsc --noEmit` -- no type errors.
    Run `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx vite build` -- build succeeds.
    Grep for `suggestNextStatus` in LeadStatusSelector.tsx confirms wiring.
    Grep for `getNotePlaceholder` in LeadNotes.tsx confirms wiring.
  </verify>
  <done>
    LeadStatusSelector shows visual accent ring on suggested next status. LeadNotes shows context-aware placeholder based on lead status. Both are non-intrusive -- user can ignore suggestions and use any value.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx tsc --noEmit` passes.
2. `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx vite build` succeeds.
3. Grep confirms `suggestNextStatus` used in LeadStatusSelector.tsx.
4. Grep confirms `getNotePlaceholder` used in LeadNotes.tsx.
5. Grep confirms `status={lead.status}` passed to LeadNotes in LeadDetail.tsx.
</verification>

<success_criteria>
- LeadStatusSelector visually highlights the suggested next pipeline status with accent ring
- LeadNotes textarea shows status-specific placeholder (e.g., "How did the outreach go?" for reached_out)
- Default fallback placeholder works when status is missing or unknown
- No functional changes to status update or note submission behavior
- All suggestions are overridable (purely visual hints)
</success_criteria>

<output>
After completion, create `.planning/phases/17-lazyflow-ux-overhaul/17-03-SUMMARY.md`
</output>
