---
phase: 17-lazyflow-ux-overhaul
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/webapp/src/pages/Train.tsx
autonomous: true

must_haves:
  truths:
    - "Train page auto-selects recommended difficulty when stats load (no manual selection needed)"
    - "Quick Start button starts training immediately with recommended difficulty in one tap"
    - "Quick Start button is disabled when recommended difficulty pool is empty"
    - "User can still manually select a different difficulty after auto-selection (overridable)"
  artifacts:
    - path: "packages/webapp/src/pages/Train.tsx"
      provides: "Train page with auto-select difficulty and Quick Start button"
      contains: "Quick Start"
  key_links:
    - from: "packages/webapp/src/pages/Train.tsx"
      to: "useTrainingStats"
      via: "auto-select useEffect"
      pattern: "recommendedDifficulty.*setSelectedDifficulty"
---

<objective>
Make training start in one tap: auto-select the recommended difficulty and add a "Quick Start" button that immediately picks a scenario and starts training.

Purpose: Success Criteria 4 and 5 -- "smart defaults with 95%+ accuracy" and "condensed to single-tap completions". Training is a daily habit; reducing 3 clicks to 1 tap makes it frictionless.

Output: Updated Train.tsx with auto-difficulty selection and Quick Start button.
</objective>

<execution_context>
@/Users/dmytrolevin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dmytrolevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/webapp/src/pages/Train.tsx
@packages/webapp/src/features/train/hooks/useTrainingStats.ts
@packages/webapp/src/features/train/components/DifficultyRecommendation.tsx
@packages/webapp/src/features/train/components/DifficultyFilter.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto-select difficulty and Quick Start button to Train page</name>
  <files>
    packages/webapp/src/pages/Train.tsx
  </files>
  <action>
    Update `Train.tsx` to implement LazyFlow training:

    1. **Auto-select recommended difficulty on mount:**
       - Add `useEffect` import (already imported via `useState, useCallback, useMemo`; add `useEffect`).
       - After the `useTrainingStats()` call, add a `useEffect` that auto-selects:
         ```typescript
         // Auto-select recommended difficulty when stats load (LazyFlow smart default)
         useEffect(() => {
           if (selectedDifficulty === null && stats.recommendedDifficulty !== null) {
             setSelectedDifficulty(stats.recommendedDifficulty);
           }
         }, [stats.recommendedDifficulty, selectedDifficulty]);
         ```
       - This runs once when stats load and sets the recommended difficulty. If the user has already manually selected something (selectedDifficulty !== null), it does NOT override their choice.

    2. **Add Quick Start button:**
       - Create a `handleQuickStart` callback:
         ```typescript
         const handleQuickStart = useCallback(() => {
           // Use recommended difficulty, or current selection, or fallback to null (random)
           const targetDifficulty = stats.recommendedDifficulty ?? selectedDifficulty;
           if (targetDifficulty !== null && targetDifficulty !== selectedDifficulty) {
             setSelectedDifficulty(targetDifficulty);
           }
           const scenario = pickRandomScenario();
           if (scenario) {
             setCurrentScenario(scenario);
             setStep('scenario');
           }
         }, [stats.recommendedDifficulty, selectedDifficulty, pickRandomScenario]);
         ```
       - PITFALL: `pickRandomScenario` uses `pool` which depends on `selectedDifficulty`. If we change difficulty and immediately pick, the pool may not have updated yet. To solve this cleanly:
         - Quick Start should use the CURRENT pool (which matches selectedDifficulty). Since auto-select already sets `selectedDifficulty` to recommended on mount, by the time the user taps Quick Start, the pool is already filtered correctly.
         - The `handleQuickStart` should simply call `handleStart()` -- it just needs to be a prominent button. The auto-select handles the "right difficulty" part.
       - So actually, simplify: `handleQuickStart` is just `handleStart` with a different label. The intelligence is in the auto-select.

    3. **Render the Quick Start button in the filter step:**
       - In the filter step render section (the last return block), add the Quick Start button ABOVE the existing DifficultyRecommendation:
         ```tsx
         {/* Quick Start -- one-tap training with smart defaults */}
         {stats.recommendedDifficulty !== null && !isLoading && (
           <Button
             variant="primary"
             size="lg"
             className="w-full"
             onClick={handleStart}
             disabled={poolSize === 0}
           >
             Quick Start
           </Button>
         )}
         ```
       - Place this right after the `<h1>` and description paragraph, BEFORE `DifficultyRecommendation`.
       - This appears ONLY when a recommendation exists (user has enough training history). New users without recommendation see the normal flow.

    4. **Update the existing Start Training button:**
       - When Quick Start is shown, the bottom "Start Training" button still exists for users who manually changed difficulty. Keep it but change it to a secondary style when Quick Start is visible:
         ```tsx
         <Button
           variant={stats.recommendedDifficulty !== null ? 'secondary' : 'primary'}
           size="lg"
           className="w-full"
           onClick={handleStart}
           disabled={poolSize === 0}
         >
           Start Training
         </Button>
         ```

    5. **Handle empty pool edge case for Quick Start:**
       - The `disabled={poolSize === 0}` already handles this. If the recommended difficulty has no scenarios (all seen), the button is disabled.
       - The DifficultyRecommendation card still shows so user knows what was recommended.

    IMPORTANT: Do NOT remove the DifficultyFilter, DifficultyRecommendation, or ScenarioVariety components. They remain for users who want manual control. Quick Start is additive.
    IMPORTANT: Smart default must be overridable -- if user taps a different difficulty pill, their choice sticks.
  </action>
  <verify>
    Run `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx tsc --noEmit` -- no type errors.
    Run `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx vite build` -- build succeeds.
    Grep for "Quick Start" in Train.tsx confirms button exists.
    Grep for "recommendedDifficulty.*setSelectedDifficulty" in Train.tsx confirms auto-select wired.
  </verify>
  <done>
    Train page auto-selects recommended difficulty on mount. Quick Start button visible when recommendation exists. User can override by manually selecting different difficulty. Pool-empty edge case handled (button disabled).
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx tsc --noEmit` passes.
2. `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx vite build` succeeds.
3. Train.tsx contains "Quick Start" button and auto-select useEffect.
</verification>

<success_criteria>
- Recommended difficulty auto-selected when Train page opens (no manual tap needed)
- "Quick Start" button visible for users with training history
- Manual difficulty override still works (user choice respected)
- New users without recommendation see normal flow (no Quick Start button)
- Empty pool disables Quick Start button
</success_criteria>

<output>
After completion, create `.planning/phases/17-lazyflow-ux-overhaul/17-02-SUMMARY.md`
</output>
