---
phase: 15.1-lead-enhancements
plan: 03
subsystem: bot-handlers
tags: [comment, linkedin, engagement, standalone]

dependency-graph:
  requires: [15.1-phase-setup]
  provides: [standalone-comment-flow, comment-regeneration]
  affects: [engagement-features]

tech-stack:
  added: []
  patterns: [fsm-state-flow, callback-regeneration, vision-llm]

key-files:
  created:
    - bot/handlers/comment.py
    - prompts/standalone_comment.md
  modified:
    - bot/states.py
    - bot/main.py

decisions:
  - id: standalone-vs-lead-context
    choice: "Separate standalone flow without prospect context"
    reason: "Users want quick engagement without creating leads"
  - id: three-tone-options
    choice: "Professional/Thoughtful, Casual/Friendly, Value-Adding Question"
    reason: "Different engagement contexts need different comment styles"
  - id: regeneration-modifiers
    choice: "Bolder and More Professional as regeneration options"
    reason: "Most common adjustments users need after initial generation"

metrics:
  duration: 3m
  completed: 2026-02-05
---

# Phase 15.1 Plan 03: Standalone Comment Flow Summary

Standalone /comment command for generating LinkedIn post comment suggestions without existing lead context.

## What Was Built

### New Handler: `/comment`

```
User sends /comment
  -> Bot prompts for LinkedIn post screenshot
  -> User sends screenshot
  -> LLM analyzes post, generates 3 comment options
  -> User can regenerate with tone modifiers
  -> Done exits flow
```

### FSM States (bot/states.py)

```python
class CommentSupportState(StatesGroup):
    waiting_screenshot = State()
    refining_comment = State()
```

### Comment Prompt (prompts/standalone_comment.md)

Three distinct comment tones:
1. **Professional/Thoughtful** - demonstrates expertise
2. **Casual/Friendly** - builds rapport
3. **Value-Adding Question** - sparks discussion

### Regeneration Actions

- **Regenerate** - fresh approaches, different angles
- **Bolder** - stronger positions, more confident
- **More Professional** - formal tone, credibility emphasis
- **Done** - exit flow

## Key Files

| File | Purpose |
|------|---------|
| `bot/handlers/comment.py` | /comment flow: cmd, photo handler, callbacks |
| `bot/states.py` | CommentSupportState FSM group |
| `prompts/standalone_comment.md` | 3-option comment generation prompt |
| `bot/main.py` | Router registration |

## Implementation Details

### Flow Independence

The /comment flow is completely independent from the leads system:
- No lead creation
- No prospect context
- No web research
- Just screenshot -> comments -> done

### Image Handling

Uses existing `pre_resize_image` utility from `bot/services/image_utils.py` to ensure vision model compatibility.

### LLM Integration

Uses the user's configured provider (OpenRouter/Claude) via `create_provider()` - same pattern as /support.

## Commits

| Hash | Description |
|------|-------------|
| `ec6b159` | Add CommentSupportState and standalone comment prompt |
| `66cf149` | Add /comment handler with regeneration actions |

## Deviations from Plan

None - plan executed exactly as written.

## Testing Notes

To test:
1. Run `/comment` in bot
2. Send screenshot of any LinkedIn post
3. Verify 3 comment options appear
4. Test regeneration buttons
5. Test Done exits cleanly
6. Test /cancel during screenshot wait

## Next Phase Readiness

Phase 15.1 Plan 03 is complete. Ready for next plan in phase.
