---
phase: 10-error-handling-and-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/webapp/src/shared/ui/ErrorBoundary.tsx
  - packages/webapp/src/shared/ui/ErrorCard.tsx
  - packages/webapp/src/shared/ui/EmptyState.tsx
  - packages/webapp/src/shared/ui/Toast.tsx
  - packages/webapp/src/shared/ui/index.ts
  - packages/webapp/src/shared/stores/toastStore.ts
  - packages/webapp/src/app/App.tsx
  - packages/webapp/src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "An unhandled React render error shows a branded fallback page with a retry button instead of a white screen"
    - "ErrorCard component renders a consistent error state with icon, message, and optional retry action"
    - "Toast notifications appear at the top of the viewport with slide-in animation and auto-dismiss"
    - "EmptyState component renders an icon, title, description, and optional CTA button"
  artifacts:
    - path: "packages/webapp/src/shared/ui/ErrorBoundary.tsx"
      provides: "React 18 class component error boundary"
      min_lines: 30
    - path: "packages/webapp/src/shared/ui/ErrorCard.tsx"
      provides: "Reusable query error display component"
      exports: ["ErrorCard"]
    - path: "packages/webapp/src/shared/ui/EmptyState.tsx"
      provides: "Reusable empty state component with icon, title, description, CTA"
      exports: ["EmptyState"]
    - path: "packages/webapp/src/shared/ui/Toast.tsx"
      provides: "Toast container component rendering from Zustand store"
      exports: ["ToastContainer"]
    - path: "packages/webapp/src/shared/stores/toastStore.ts"
      provides: "Zustand toast store with add/dismiss actions"
      exports: ["useToast", "useToastStore"]
  key_links:
    - from: "packages/webapp/src/app/App.tsx"
      to: "packages/webapp/src/shared/ui/ErrorBoundary.tsx"
      via: "ErrorBoundary wraps outermost App tree"
      pattern: "<ErrorBoundary>"
    - from: "packages/webapp/src/app/App.tsx"
      to: "packages/webapp/src/shared/ui/Toast.tsx"
      via: "ToastContainer rendered inside App"
      pattern: "<ToastContainer"
    - from: "packages/webapp/src/shared/ui/Toast.tsx"
      to: "packages/webapp/src/shared/stores/toastStore.ts"
      via: "ToastContainer reads from Zustand store"
      pattern: "useToastStore"
---

<objective>
Create the four core UI building blocks for Phase 10 error handling: ErrorBoundary, ErrorCard, Toast system, and EmptyState component. Wire ErrorBoundary and ToastContainer into App.tsx.

Purpose: These components are the foundation that Plans 02 and 03 will integrate into all existing pages. Without them, nothing else in Phase 10 can proceed.
Output: Four new shared UI components, a Zustand toast store, updated App.tsx with error boundary wrapping, and toast CSS keyframes.
</objective>

<execution_context>
@/Users/dmytrolevin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dmytrolevin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-error-handling-and-ux/10-RESEARCH.md

Key existing files to reference for patterns:
@packages/webapp/src/app/App.tsx
@packages/webapp/src/app/globals.css
@packages/webapp/src/shared/ui/index.ts
@packages/webapp/src/shared/ui/Card.tsx
@packages/webapp/src/shared/ui/Button.tsx
@packages/webapp/src/shared/lib/cn.ts
@packages/webapp/src/features/auth/store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ErrorBoundary, ErrorCard, EmptyState, and Toast components</name>
  <files>
    packages/webapp/src/shared/ui/ErrorBoundary.tsx
    packages/webapp/src/shared/ui/ErrorCard.tsx
    packages/webapp/src/shared/ui/EmptyState.tsx
    packages/webapp/src/shared/ui/Toast.tsx
    packages/webapp/src/shared/stores/toastStore.ts
    packages/webapp/src/shared/ui/index.ts
    packages/webapp/src/app/globals.css
  </files>
  <action>
    **ErrorBoundary.tsx** -- React 18 class component (functional components cannot be error boundaries):
    - Props: `children: ReactNode`
    - State: `{ hasError: boolean; error: Error | null }`
    - `getDerivedStateFromError(error)` sets `hasError: true, error`
    - `componentDidCatch(error, info)` logs `console.error('[ErrorBoundary]', error, info.componentStack)`
    - `handleRetry` resets state to `{ hasError: false, error: null }`
    - Fallback UI: full-height centered layout with AlertTriangle icon from lucide-react in a `bg-error/10` circle, "Something went wrong" heading, "The app encountered an unexpected error. Try refreshing." description, and a Button (from existing `@/shared/ui`) with `onClick={this.handleRetry}` labeled "Try Again"
    - Use existing design tokens: `text-text-primary`, `text-text-secondary`, `bg-surface`, `bg-error/10`
    - The fallback should fill `h-screen` with `flex flex-col items-center justify-center gap-4 px-6 text-center`

    **ErrorCard.tsx** -- Functional component for standardized query error display:
    - Props: `{ message?: string; onRetry?: () => void; compact?: boolean }`
    - Default message: `"Failed to load data"`
    - When `compact={true}`: renders just `flex items-center gap-2` with AlertCircle icon (16px, `text-error`), message text (`text-sm text-text-hint`), and if `onRetry` provided a "Retry" text button (`text-accent text-xs font-medium`)
    - When `compact={false}` (default): wraps in a Card with `py-6 text-center` containing AlertCircle icon (24px, `text-error`), message, and if `onRetry` provided a Button variant="secondary" size="sm" with RefreshCw icon + "Retry"
    - Import AlertCircle and RefreshCw from lucide-react
    - Import Card from `@/shared/ui/Card` and Button from `@/shared/ui/Button`

    **EmptyState.tsx** -- Functional component for designed empty data states:
    - Props: `{ icon: LucideIcon; title: string; description: string; action?: { label: string; onClick: () => void } }`
    - Layout: `flex flex-col items-center gap-3 rounded-card bg-surface-secondary/30 p-8 text-center`
    - Icon in a `h-12 w-12 flex items-center justify-center rounded-full bg-accent/10` circle, icon itself `h-6 w-6 text-accent`
    - Title: `text-sm font-semibold text-text-secondary`
    - Description: `text-xs text-text-hint max-w-[240px]`
    - Optional action: Button variant="secondary" size="sm" with the label text
    - Import LucideIcon type from lucide-react

    **toastStore.ts** -- Zustand store (follows existing authStore pattern):
    - Interface `Toast`: `{ id: string; type: 'success' | 'error'; message: string; action?: { label: string; onClick: () => void } }`
    - Interface `ToastState`: `{ toasts: Toast[]; addToast: (toast: Omit<Toast, 'id'>) => void; dismissToast: (id: string) => void }`
    - `addToast`: generates id with `Date.now().toString(36) + Math.random().toString(36).slice(2)`, appends to array (max 3 toasts -- shift oldest if exceeded), and sets `setTimeout(() => dismissToast(id), 4000)` for auto-dismiss
    - `dismissToast`: filters out toast by id
    - Export `useToastStore` (the raw store) and a convenience `useToast` hook that returns `{ toast: (opts) => addToast(opts) }`
    - Create directory `packages/webapp/src/shared/stores/` if needed

    **Toast.tsx** -- ToastContainer component:
    - Reads `toasts` from `useToastStore`
    - Renders a fixed-position container: `fixed top-[calc(var(--spacing-content-top)+0.5rem)] left-4 right-4 z-50 flex flex-col gap-2 pointer-events-none`
    - Each toast: `pointer-events-auto` div with `animate-toast-slide-in` animation, rounded-card, shadow-lg, padding
    - Success toasts: `bg-success text-white` with CheckCircle icon
    - Error toasts: `bg-error text-white` with AlertCircle icon
    - Each toast has a dismiss X button and optional action button
    - Action button: `text-white/90 underline text-xs font-medium` -- calls `action.onClick()` then dismisses the toast

    **globals.css** -- Add toast slide-in keyframe:
    ```css
    @keyframes toast-slide-in {
      from {
        opacity: 0;
        transform: translateY(-1rem);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    ```
    Add to the @theme block: `--animate-toast-slide-in: toast-slide-in 0.2s ease-out;`

    **index.ts** -- Add exports for all new components:
    - `export { ErrorBoundary } from './ErrorBoundary';`
    - `export { ErrorCard, type ErrorCardProps } from './ErrorCard';`
    - `export { EmptyState, type EmptyStateProps } from './EmptyState';`
    - `export { ToastContainer } from './Toast';`
  </action>
  <verify>Run `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx tsc --noEmit` -- must pass with zero errors.</verify>
  <done>All four components exist, compile cleanly, and are exported from the shared/ui barrel file. Toast store exists at shared/stores/toastStore.ts.</done>
</task>

<task type="auto">
  <name>Task 2: Wire ErrorBoundary and ToastContainer into App.tsx</name>
  <files>
    packages/webapp/src/app/App.tsx
  </files>
  <action>
    Update App.tsx to wrap the entire tree with ErrorBoundary and add ToastContainer:

    ```typescript
    import { ErrorBoundary, ToastContainer } from '@/shared/ui';
    import { AuthProvider } from '@/app/providers/AuthProvider';
    import { QueryProvider } from '@/app/providers/QueryProvider';
    import { AppRouter } from '@/app/Router';

    export default function App() {
      return (
        <ErrorBoundary>
          <AuthProvider>
            <QueryProvider>
              <ToastContainer />
              <AppRouter />
            </QueryProvider>
          </AuthProvider>
        </ErrorBoundary>
      );
    }
    ```

    **Key placement decisions:**
    - ErrorBoundary is OUTERMOST -- catches errors from AuthProvider, QueryProvider, and all routes
    - ToastContainer is INSIDE QueryProvider so mutations can trigger toasts, but ABOVE AppRouter so it persists across route changes
    - ToastContainer uses Zustand (not Context), so it does NOT need a provider wrapper -- it reads from the standalone store directly
    - Update the JSDoc comment to reflect the new provider order: ErrorBoundary > AuthProvider > QueryProvider > ToastContainer + AppRouter
  </action>
  <verify>Run `cd /Users/dmytrolevin/Downloads/GD_playground/packages/webapp && npx tsc --noEmit` -- must pass. Then run `npx vite build` -- must produce a successful build with no errors.</verify>
  <done>App.tsx wraps the tree with ErrorBoundary, ToastContainer is rendered inside QueryProvider, TypeScript compiles, and Vite builds successfully.</done>
</task>

</tasks>

<verification>
1. `cd packages/webapp && npx tsc --noEmit` -- zero TypeScript errors
2. `cd packages/webapp && npx vite build` -- successful build
3. Verify ErrorBoundary.tsx is a class component (not functional)
4. Verify toastStore.ts uses Zustand `create()` (not React Context)
5. Verify App.tsx has ErrorBoundary as outermost wrapper
</verification>

<success_criteria>
- ErrorBoundary class component exists and is wired as outermost wrapper in App.tsx
- ErrorCard component exists with `compact` mode and optional `onRetry`
- EmptyState component exists with icon, title, description, and optional CTA
- Toast system works via Zustand store with auto-dismiss and action support
- ToastContainer is rendered inside App.tsx
- All components compile and the app builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/10-error-handling-and-ux/10-01-SUMMARY.md`
</output>
